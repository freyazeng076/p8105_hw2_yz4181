---
title: "Simple document"
author: Yuanyuan Zeng
data: 2021-09-16
output: github_document
---
```{r, echo = FALSE}
library(tidyverse)
library(readxl)
library(lubridate)
library(dplyr)
```

## Problem 1

```{r}
# Read and clean the Mr.Trash Wheel sheet
trash_data = 
  read_excel("./Trash-Wheel-Collection-Totals-7-2021-sept.xlsx", sheet = "Mr. Trash Wheel") %>% 
  janitor::clean_names() %>% 
  select(dumpster:homes_powered) %>% 
  filter(dumpster != "NA") %>% 
  mutate(
    sports_balls = round(sports_balls))
str(trash_data)

# Read and clean the precipitation data for 2018
pre_2018 = (
  read_excel("./Trash-Wheel-Collection-Totals-7-2021-sept.xlsx", sheet = "2018 Precipitation", range = "A2:B14") %>% 
    janitor::clean_names() %>% 
    mutate(year = 2018) %>%  
    relocate(year))
str(pre_2018)

# Calculate total precipitation in 2018
sum(pull(pre_2018,var =3))

# Read and clean the precipitation data for 2019
pre_2019 = (
  read_excel("./Trash-Wheel-Collection-Totals-7-2021-sept.xlsx", sheet = "2019 Precipitation", range = "A2:B14") %>% 
    janitor::clean_names() %>% 
    mutate(year = 2019) %>% 
    relocate(year))
str(pre_2019)

# Combine two precipitation data
precipitation_data = (
  bind_rows(pre_2018, pre_2019) %>% 
  mutate(month = month.name[as.numeric(month)])
)
str(precipitation_data)

# find the median of number of sports ball in dumpster in 2019
filter(trash_data, year == "2019") %>% 
  pull(sports_balls) %>% 
  median()
```

* The trash_data contains 488 rows and 14 columns. There are 14 variables which are dumpster, month, year, data, weight_tons, volume_cubic_yards, plastic_bottles, polystyrene, cigarette_butts, grocery_bags, chip_bags, sports_balls, and homes_powered. Dumpster and month are character variables. Others are numeric variables. The tables both pre_2018 and pre_2019 contains 12 rows and 3 colors. There are three numeric variables which are year, month, and total. The total precipitation in 2018 is 70.33 inches. Combining two precipitation data, we get a table named precipitation_data which contains 24 rows and 3 colomns. The variable name are the same as two seperated tables. 

## Problem 2

```{r}
# Clean the data in pols-month.csv
pols_month = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv") %>% 
  separate(mon,  into = c("year", "month", "day"), sep = "-") %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  pivot_longer(
    prez_gop | prez_dem,
    names_to = "president",
    names_prefix = "prez_",
    values_to = "gop_or_dem") %>% 
  filter( gop_or_dem!=0 ) %>% 
  select(!day & !gop_or_dem) %>% 
  relocate(year, month, president, everything())

pols_month

# Clean the data in snp.csv
snp_df = 
  read_csv("./fivethirtyeight_datasets/snp.csv") %>% 
  mutate(
    date = mdy(date)
  ) %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    year = ifelse(as.numeric(year)>2049, as.numeric(year)-100, year)
  ) %>% 
  mutate(
    month = month.name[as.numeric(month)]
    ) %>% 
  select(!day) %>% 
  relocate(year) %>% 
  arrange(desc(year))

snp_df

# Clean th unemployment data 
unemployment_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv", col_types = "cdddddddddddd") %>% 
  pivot_longer(
    Jan : Dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>% 
  filter(unemployment !="NA") %>% 
  janitor::clean_names() %>% 
  mutate(
    month = match(month, month.abb),
    month = month.name[as.numeric(month)]
  ) %>% 
  arrange(desc(year)) 

unemployment_df

# left join snp into pols data set
pols_snp =
  left_join(pols_month, snp_df, by = c("year","month"))

# left join unemployment into pols_snp 
pols_snp_unemp =
  left_join(pols_snp, unemployment_df, by = c("year", "month"))
```


## Problem 3

```{r}
# Clean the data on popularity of baby names
baby_names = 
  read.csv("./Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>%
  distinct() %>% 
  mutate(
    gender = tolower(gender),
    ethnicity = tolower(ethnicity),
    ethnicity = replace(ethnicity, ethnicity == "asian and paci", "asian and pacific islander"),
    ethnicity = replace(ethnicity, ethnicity == "black non hisp", "black non hispanic"),
    ethnicity = replace(ethnicity, ethnicity == "white non hisp", "white non hispanic"),
    child_s_first_name = tolower(child_s_first_name)
  )

head(baby_names)

# Create table showing popularity of the name "Olivia"
olivia_df =
  baby_names %>% 
  filter(child_s_first_name == "olivia") %>% 
  arrange(desc(rank)) # how to arrange something in increasing order??

# Create table showing popularity of the most popular name among male children over time
popular_names =
  baby_names %>% 
  filter(
    gender != "female",
    rank == "1"
  )

# Produce scatter plot
male_non_his =
  baby_names %>% 
  filter(
    gender != "female",
    year_of_birth == "2016",
    ethnicity == "white non hispanic"
  )

ggplot(male_non_his, aes(x= rank, y = count))+
  geom_point() +
  labs(
    title = "popularity of white non hispanic male children's names",
    x = "rank in popularity of the name",
    y = "number of children with the name"
  )
```


